{% extends "base.html" %}
{% block title %}Configurações Gerais{% endblock %}
{% block header %}Configurações Gerais{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <form method="POST" class="bg-white p-6 rounded-lg shadow-md space-y-6">
        <!-- Token CSRF se você estiver usando -->
        {% if csrf_token %}
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        {% endif %}
        
        <div>
            <h2 class="text-lg font-semibold text-gray-800">Alertas de Manutenção</h2>
            <div class="mt-4">
                <label for="warning_days" class="block text-sm font-medium text-gray-700">
                    Notificar manutenções com quantos dias de antecedência?
                </label>
                <input 
                    type="number" 
                    name="warning_days" 
                    id="warning_days" 
                    value="{{ warning_days }}" 
                    min="1"
                    max="365"
                    required
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"
                >
                <p class="mt-1 text-xs text-gray-500">
                    Este valor define quando o status "Próximo do vencimento" é ativado.
                </p>
            </div>
        </div>

        <div class="border-t border-gray-200"></div>

        <div>
            <h2 class="text-lg font-semibold text-gray-800">Mensagem de Lembrete (WhatsApp)</h2>
            <div class="mt-4">
                <label for="whatsapp_template" class="block text-sm font-medium text-gray-700">
                    Modelo da mensagem
                </label>
                <textarea 
                    name="whatsapp_template" 
                    id="whatsapp_template" 
                    rows="5" 
                    placeholder="Digite sua mensagem personalizada..."
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"
                >{{ whatsapp_template }}</textarea>
                <p class="mt-2 text-xs text-gray-500">
                    Use as variáveis abaixo para personalizar a mensagem. Elas serão substituídas automaticamente:
                </p>
                <div class="mt-2 grid grid-cols-2 gap-2 text-xs text-gray-600">
                    <div>
                        <code class="bg-gray-200 text-gray-800 rounded px-1 py-0.5">{client_name}</code>
                        <span class="ml-1">Nome do cliente</span>
                    </div>
                    <div>
                        <code class="bg-gray-200 text-gray-800 rounded px-1 py-0.5">{equipment_model}</code>
                        <span class="ml-1">Modelo do equipamento</span>
                    </div>
                    <div>
                        <code class="bg-gray-200 text-gray-800 rounded px-1 py-0.5">{equipment_code}</code>
                        <span class="ml-1">Código do equipamento</span>
                    </div>
                    <div>
                        <code class="bg-gray-200 text-gray-800 rounded px-1 py-0.5">{maintenance_date}</code>
                        <span class="ml-1">Data da manutenção</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="pt-5">
            <div class="flex justify-end space-x-3">
                <button 
                    type="button" 
                    onclick="resetToDefault()" 
                    class="inline-flex items-center rounded-md bg-gray-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-gray-700"
                >
                    Restaurar Padrão
                </button>
                <button 
                    type="submit" 
                    class="inline-flex items-center rounded-md bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-700"
                >
                    Salvar Configurações
                </button>
            </div>
        </div>
    </form>
</div>

<script>
function resetToDefault() {
    const defaultTemplate = `Olá, {client_name}! Somos da SacadaGear e gostaríamos de lembrar sobre a manutenção do seu equipamento '{equipment_model} ({equipment_code})', agendada para o dia {maintenance_date}. Podemos confirmar o agendamento?`;
    document.getElementById('whatsapp_template').value = defaultTemplate;
}

// Adiciona validação no cliente
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    form.addEventListener('submit', function(e) {
        const warningDays = document.getElementById('warning_days').value;
        const template = document.getElementById('whatsapp_template').value;
        
        if (!warningDays || warningDays < 1) {
            e.preventDefault();
            alert('Por favor, insira um número válido de dias de antecedência.');
            return;
        }
        
        if (!template.trim()) {
            e.preventDefault();
            alert('Por favor, insira uma mensagem de template.');
            return;
        }
    });
});
</script>
{% endblock %}